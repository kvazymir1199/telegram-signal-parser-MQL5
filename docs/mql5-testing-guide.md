# Инструкция по техническому тестированию MQL5 EA (Milestone 2)

Этот документ описывает шаги для проверки технической логики советника `TelegramSignalExpert.mq5`.

## 1. Подготовка окружения
1. Скопируйте папку `mql5/Include/TelegramExpert` в директорию `MQL5/Include/` вашего терминала.
2. Скопируйте файл `mql5/TelegramSignalExpert.mq5` в директорию `MQL5/Experts/`.
3. Убедитесь, что файл базы данных `telegram_signals.sqlite3` находится в папке `MQL5/Files/`.
4. В настройках терминала (Сервис -> Настройки -> Советники) разрешите импорт функций из DLL (хотя мы их не используем, это хорошая практика для сложных советников) и убедитесь, что торговля разрешена.

## 2. Сценарии тестирования

### А. Проверка входа (Entry Conditions)
1. **Цель:** Убедиться, что EA входит в сделку при попадании цены в диапазон или отклонении <= 0.03.
2. **Шаги:**
   - Вручную вставьте запись в таблицу `signals` со статусом `PROCESS` и ценой входа, близкой к текущему рынку.
   - Запустите советник.
   - Проверьте вкладку "Эксперты": должно появиться сообщение об исполнении и открыться два ордера (TP1 и TP2).

### Б. Проверка TP1 и Безубытка (Breakeven)
1. **Цель:** Проверить перенос SL второго ордера в БУ после закрытия первого по TP.
2. **Шаги:**
   - Дождитесь закрытия первого ордера по Take Profit 1.
   - Сразу проверьте состояние второго ордера: его Stop Loss должен стать равен цене открытия (`PriceOpen`).

### В. Проверка смены сигнала
1. **Цель:** Убедиться, что новый сигнал закрывает старые сделки.
2. **Шаги:**
   - При наличии открытых позиций добавьте в БД новый сигнал со статусом `PROCESS`.
   - Советник должен немедленно закрыть текущие позиции и открыть новые по свежему сигналу.

### Г. Риск-менеджмент (3% Daily Loss)
1. **Цель:** Проверить блокировку торговли при убытке.
2. **Шаги:**
   - Установите в настройках `InpMaxDailyLoss = 0.1` (для быстрого теста).
   - Вручную закройте любую сделку с убытком > 0.1% от эквити.
   - Советник должен вывести в лог сообщение о критическом убытке и заблокировать торговлю до времени `InpStartTimeJST` следующего дня.

### Д. Проверка времени JST
1. **Цель:** Убедиться в корректности сброса лимитов.
2. **Шаги:**
   - Проверьте сообщение в логе при инициализации: `RM: Лимиты будут сброшены в 07:10 JST (GMT: ...)`.
   - Время GMT должно соответствовать 22:10 предыдущего или текущего дня.

## 3. Ожидаемые результаты в логах
- `SM: Все модули успешно инициализированы.`
- `TE: Ордер TP1 закрыт. Перенос позиции #... в безубыток.`
- `RM: КРИТИЧЕСКИЙ УБЫТОК! ... >= ... Блокировка.`
- `SM: Сигнал ID:... успешно исполнен.`
